{% extends "base2.html" %}

{% block content %}

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.css" />
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.js"></script>
<script>
  $(document).ready(function(){
    new DataTable($('#sort_sidx'), {
      order: [[0, 'asc']],
    });
    new DataTable($('#sort_similarity'), {
      order: [[4, 'desc']],
    });
  })

</script>

<br>

<div class="site_body">
  <h4><i>{{metadata[0].title}}</i></h4>
  <h5>{{metadata[0].authors}}</h5>
  <h6><b>Publisher:</b> {{metadata[0].publisher}}</h6>
  <h6><b>Place of Publication:</b> {{metadata[0].pubplace}}</h6>
  <h6><b>Publication Year:</b> {{metadata[0].pubyear}}</h6>
  <h6><b>TCP ID:</b> {{metadata[0].tcpID}} <b>ESTC ID:</b> {{metadata[0].estc}} <b>STC ID:</b> {{metadata[0].stc}}</h6>
  <h6>   
     <a href="{{ url_for('sermon.full_text',tcpID=metadata[0].tcpID) }}"><u>View Full Text</u></a>
      <!-- <a href="{{ url_for('sermon.get_citations',tcpID=metadata[0].tcpID) }}"><u>View All References</u></a> -->
    </h6>  
  <img src="/static/images/border4.png"><img src="/static/images/border4.png">
  
  <br>
  <h4><i>Possible Citations</i></h4>

  <table class='table is-striped' id="sort_sidx">
    <thead class="grey_table" >
      <tr>
        <th scope="col">Index and Location of Segment</th>
        <th scope="col">Index of Citation in Segment</th>
        <th scope="col">Parsed Citation(s)</th>
        <th scope="col">Unparsable Citation(s)</th>
        <th scope="col">Original Phrase (lightly preprocessed)</th>
        <th scope="col">Text of Segment and Notes</th>
      </tr>
    </thead>
    <tbody>
      {% for c in citations%}
        <tr>
          <td>{{c.sidx}} <br> {{c.loc}}</td>
          <td>{{c.cidx}}</td>
          <td>{{c.citation}}</td>
          <td>{{c.outlier}}</td>
          <td>{{c.replaced}}</td>
          <td>
            <a href="{{ url_for('sermon.get_segment_and_notes',tcpID=c.tcpID,sidx=c.sidx) }}"><u><b>View</b></u></a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <img src="/static/images/border4.png"><img src="/static/images/border4.png">
  
  <br>
  <h4><i>Possible Quotations or Paraphrases</i></h4>
  <table class='table is-striped' id="sort_similarity">
    <thead class="grey_table" >
      <tr>
        <th scope="col">Index and Location of Segment</th>
        <th scope="col">Verse of Bible</th>
        <th scope="col">Full Verse Text</th>
        <th scope="col">Subphrase of Verse (lemmatized)</th>
        <th scope="col">Similarity Score</th>
        <th scope="col">Candidate Text</th>
        <th scope="col"></th>
      </tr>
    </thead>
    <tbody>
      {% for q in possible_qp %}
        <tr>
          <td>{{q.sidx}} <br> {{q.loc}}</td>
          <td>{{q.label}}</td>
          <td>{{q.full}}</td>
          <td>{{q.phrase}}</td>
          <td>{{q.score}}</td>
          <td>{{qp_segments[(q.tcpID,q.sidx,q.loc)]}}
            <br>
            <a href="{{ url_for('sermon.get_segment_and_notes',tcpID=q.tcpID,sidx=q.sidx) }}"><u><b>View Segment Information</b></u></a>
          </td>
          <td>
            <form action="{{ url_for('sermon.remove_qp',tcpID=q.tcpID, sidx=q.sidx, vidx=q.vidx)}}" method="POST" >
              <input type="hidden" id="page" name="page" value="sermon">
              <input type="submit" value="Remove" class="btn-gray"/> 
             </form>   
          </td>   
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

</div>

{% endblock %}
