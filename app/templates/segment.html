{% extends "base2.html" %}

{% block content %}

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.css" />
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.js"></script>
<script>
  (function () {
	window.onpageshow = function(event) {
		if (event.persisted) {
			window.location.reload();
		}
	};
})();

  $(document).ready(function(){
      new DataTable($('#sort_sidx'), {
      order: [[0, 'asc']],

    });
    new DataTable($('#sort_sim'), {
      order: [[4, 'desc']],

    });
    new DataTable($('#sort_qp'), {
      order: [[0, 'asc']],

    });
    new DataTable($('#sort_citation'), {
      order: [[0, 'asc']],

    });
  })
</script>

<br>
<div class="site_body">
  <h4><i>{{metadata[0].title}}</i></h4>
  <h5>
    {% for aut in unique_aut %}
    <a href="{{ url_for('author.find_author_references',author=aut[0])}}"><u>{{aut[0]}}</u></a>
    <br>
    {% endfor %}
    
  </h5>
  <h6><b>Publisher:</b> {{metadata[0].publisher}}</h6>
  <h6><b>Place of Publication:</b> {{metadata[0].pubplace}}</h6>
  <h6><b>Publication Year:</b> {{metadata[0].pubyear}}</h6>
  <h6><b>TCP ID:</b> {{metadata[0].tcpID}} <b>ESTC ID:</b> {{metadata[0].estc}} <b>STC ID:</b> {{metadata[0].stc}}</h6>
  <h6><b>Subject Headings:</b> {{metadata[0].subject_headings}}</h6>
  <h6>   
     <a href="{{ url_for('sermon.full_text',tcpID=metadata[0].tcpID) }}"><u>View Full Text</u></a>
     &ThickSpace;
     <a href="{{ url_for('sermon.get_citations',tcpID=metadata[0].tcpID) }}"><u>View All References</u></a>
    </h6>  
    <div class="full_break">
      <img src="/static/images/border4.png"><img src="/static/images/border4.png"><img src="/static/images/border4.png">
    </div>  
  <br>
  <h4>Segment {{sidx}} located on {{loc_type.lower().capitalize()}} {{loc}}</h4>
  {% if sidx > 0 %}
  <a href="{{ url_for('sermon.get_segment_and_notes',tcpID=tcpID,sidx=sidx-1) }}"><u>< Previous Segment </u></a>
  &ThickSpace;  &ThickSpace;
  {% endif %}
  {% if nextsegment > 0 %}
  <a href="{{ url_for('sermon.get_segment_and_notes',tcpID=tcpID,sidx=sidx+1) }}"><u>Next Segment ></u></a>
  {% endif %}
  <br><br>
  <table class='table is-striped' id="sort_sidx">
    <thead class="grey_table" >
      <tr>
        <th scope="col">Location</th>
        <th scope="col">Text (tokenized)</th>

      </tr>
    </thead>
    <tbody>
      {% for s in segment %}
      <tr>
          <td>{{s[2]}}</td> 
          <td>{{s[0]}}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="full_break">
    <img src="/static/images/border4.png"><img src="/static/images/border4.png"><img src="/static/images/border4.png">
  </div>
  <br>
    <h3>Citations </h3>
    </h5>
    <p>The index of citation indicates its position within the text of the segment or a particular note of the segment.
      For example, if 'Note 0' (i.e., the first note) of this segment has three citations, the citation with index 0 is its first citation, 
      inclusive of all its parsed components. Each citation unit is a book and chapter. Hence, a phrase 
      'Ro. 1.3-5' in the text counts as a single citation with components "Romans 1.3; Romans 1.4; Romans 1.5."
      If the citation unit is preprocessed, then all of its punctuation besides commas and hyphens have been removed 
      and Roman numerals have been converted to integers.
    </p>
    <p>
      To edit a parsed citation, please follow the standard format of a period between chapter and verse, 
      semi-colons to separate components, and no extra spaces. For consecutive citations, use a hyphen between verses,
      such as '1 Chronicles 26.1-16'.
      If the citation index requires an update, 
      the indices of the other citations within the body text or particular note must first be shifted to ensure 
      that each index is unique for each location. To only update a citation's index, leave the first text box blank.
    </p>
    <h5>Version of Bible: {{biblever}}</h5>
    <table class='table is-striped' id="sort_citation">
      <thead class="grey_table" >
        <tr>
          <th scope="col">Location</th>
          <th scope="col">Index of Citation</th>
          <th scope="col">Phrase</th>
          <th scope="col">Parsed Citations </th>
          {% if t_outlier %}
          <th scope="col">Unparsable Citations</th>
          {% endif %}
          <th scope="col">Modify</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        {% for c in citations%}
          <tr>
            <td>{{c[2]}}</td>
            <td>{{c[3]}}</td>
            <td>{{c[1]}} <br>
            <td>{{c[0]}} <br>
            </td>   
            {% if t_outlier %}
                <td>{{"; ".join(c_dict['t_outlier'][0])}}</td> 
            {% endif %}
            <td>
              <form action="{{ url_for('sermon.edit_citation',tcpID=tcpID,sidx=sidx,loc=c[2])}}" method="POST" >
                <input type="hidden" id="orig_cidx" name="orig_cidx" value="{{c[3]}}">
                <label for="text">Edited Citation: </label>
                <br>
                <input type="text" id="new_citation" name="new_citation">
                <br>
                <label for="text">Edited Phrase: </label>
                <br>
                <input type="text" id="new_phrase" name="new_phrase">
                <br>
                <label for="cidx">Index Within Text or Note: </label>
                <br>
                <input type="number" id="cidx" name="cidx" min="0" value="{{c[3]}}">
                <input type="submit" value="Submit" class="btn-gray"/> 
               </form> 
            </td>
            <td>              
              <form action="{{ url_for('sermon.remove_citation',tcpID=tcpID,sidx=sidx,loc=c[2],cidx=c[3])}}" method="POST" >
                <input type="submit" value="Remove" class="btn-gray"/> 
               </form>   
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <form action="{{ url_for('sermon.edit_version',tcpID=tcpID)}}" method="POST" >
      <input type="hidden" id="sidx" name="sidx" value="{{sidx}}">
      <label for="ver"><h5><b>Edit Version of Bible:</b> </h5></label>
       &VeryThinSpace;
        <select id="ver" name="ver" REQUIRED>
          <option value="" disabled selected></option>
          <option value="King James Version">King James Version</option>
          <option value="King James Version">Geneva Version</option>
          <option value="Douay–Rheims Bible">Douay–Rheims Bible</option>
          <option value="Vulgate">Vulgate</option>
      </select>
      <input type="submit" value="Submit" class="btn-gray"/>
    </form>

    <h5><b>Add New Citation:</b> </h5>
    <form action="{{ url_for('sermon.add_citation',tcpID=tcpID,sidx=sidx)}}" method="POST" >
      <label for="loc">Location of new citation: </label>
      <select id="loc" name="loc" REQUIRED>
        {% for v in locations%}
        <option value="{{v}}">{{v}}</option>
        {% endfor %}
    </select>
    &VeryThinSpace;
    <label for="cidx">Index of new citation: </label>
    <input type="number" id="cidx" name="cidx" cols="2" REQUIRED>
    <br>
    <label for="orig">Phrase: </label>
      <input type="text" id="orig" name="orig" REQUIRED>
      <br>
      <label for="parsed">Parsed Citation: </label>
      <input type="text" id="parsed" name="parsed" REQUIRED>
      <input type="submit" value="Submit" class="btn-gray"/> 
     </form> 
  <br>

  <div class="full_break">
    <img src="/static/images/border4.png"><img src="/static/images/border4.png"><img src="/static/images/border4.png">
  </div>
  <br>
  
  <h3>Actual Quotations or Paraphrases</h3>
  <table class='table is-striped' id="sort_qp">
    <thead class="grey_table" >
      <tr>
        <th scope="col">Location in Segment</th>
        <th scope="col">Verse of Bible</th>
        <th scope="col">Full Verse Text</th>
        <th scope="col">Phrase of Segment</th>
        <th scope="col">Remove Reference</th>
      </tr>
    </thead>
    <tbody>
      {% for q in actual_qp %}
        <tr>
          <td>{{q[2]}}</td>
          <td>{{q[3]}}
            <br>
              <a href="{{ url_for('sermon.semantic_search_verse_get',verse_id=q[3]) }}"><u>Search for Verse</u></a>
          </td>
          <td>{{q[4]}}</td>
          <td>{{q[5]}}</td>
          <td>
            <form action="{{ url_for('sermon.remove_actual_qp',tcpID=tcpID, sidx=sidx, loc=q[2],verse_id=q[3])}}" method="POST" >
              <input type="hidden" id="page" name="page" value="segment">
              <input type="submit" value="Remove" class="btn-gray"/> 
             </form>   
          </td>  
        </tr>
      {% endfor %}
    </tbody>
  </table>
      
  
  <br>
  <h3>Possible Quotations or Paraphrases</h3>
  <form action="{{ url_for('sermon.search_in_bible',tcpID=tcpID,sidx=sidx) }}" method="POST" class="my_button">
    <label for="phrase"><b>Search within the Bible (for better results, use short phrases of the lemmatized text): </b></label>
    <p>{{segment[0][1]}}</p>
    <textarea id="phrase" name="phrase" rows="2" cols="10"></textarea>
    <input type="hidden" id="page" name="page" value="segment">
    <br>
   <label for="loc">Location of phrase: </label>
    <select id="loc" name="loc" REQUIRED>
      {% for v in locations%}
      <option value="{{v}}">{{v}}</option>
      {% endfor %}
    </select>
   <br>
   <label for="collection">Select a version: </label>
        <select id="version" name="version" REQUIRED>
            <option value="King James Version">King James Version</option>
        </select>
       <br>
   <label for="k">Number of desired results: </label>
    <input type="number" name="k" value="20" REQUIRED>
    <br>
   <input type="submit" value="Submit" class="btn-gray"> 
   </form>

  <br>
  {% if qp_candidates %}
  <table class='table is-striped' id="sort_sim">
    <thead class="grey_table" >
      <tr>
        <th scope="col">Location in Segment</th>
        <th scope="col">Verse of Bible</th>
        <th scope="col">Full Verse Text</th>
        <th scope="col">Subphrase of Verse (lemmatized)</th>
        <th scope="col">Similarity Score</th>
        <th scope="col">Remove from Candidates</th>
        <th scope="col">Add As Actual Reference</th>
      </tr>
    </thead>
    <tbody>
      {% for q in qp_candidates %}
        <tr>
          <td>{{q[0]}}</td>
          <td>{{q[1]}}
            <br>
              <a href="{{ url_for('sermon.semantic_search_verse_get',verse_id=q[1]) }}"><u>Search for Verse</u></a>
          </td>
          <td>{{q[2]}}</td>
          <td>{{q[3]}}</td>
          <td>{{q[4]}}</td>
          <td>
            <form action="{{ url_for('sermon.remove_qp',tcpID=tcpID, sidx=sidx, vidx=q[5])}}" method="POST" >
              <input type="hidden" id="page" name="page" value="segment">
              <input type="submit" value="Remove" class="btn-gray"/> 
             </form>   
          </td>  
          <td> 
            <form action="{{ url_for('sermon.add_qp',tcpID=tcpID, sidx=sidx, verse_id=q[1],loc=q[0])}}" method="POST" >
              <input type="hidden" id="page" name="page" value="segment">
              <label for="phrase">Phrase of Text</label>
              <input type="text" id="phrase" name="phrase">
              <input type="submit" value="Add As Reference" class="btn-gray"/> 
             </form> 
          </td> 
        </tr>
      {% endfor %}
    </tbody>
  </table>
     {% endif %} 
</div>

</div>

{% endblock %}
